<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
   <mapper namespace="com.situ.xuexiao.dao.TeacherDao">
   		<resultMap type="Teacher" id="findTeacher">
   			<id column="sequenceNO" property="sequenceNO"/>
	  		<result column="ID" property="ID"/>	
	  		<result column="name" property="name"/>	
	  		<result column="age" property="age"/>	
	  		<result column="gender" property="gender"/>	
	  		<result column="address" property="address"/>	
	  		<result column="birthday" property="birthday"/>
	  		<result column="picture" property="picture"/>
	  		<association property="category" javaType="Category">
	  			<id column="SequenceNO" property="sequenceNO"/>
	  			<result column="categoryID" property="ID"/>
	  			<result column="parentID" property="parentID"/>
	  			<result column="title" property="title"/>
	  		</association>	
	  		<association property="course" javaType="Course">
	  			<id column="SequenceNO" property="sequenceNO"/>
	  			<result column="courseID" property="ID"/>
	  			<result column="coursename" property="name"/>
	  			<result column="score" property="score"/>
	  		</association>	
	  		<association property="attence" javaType="Attence">
	  			<id column="SequenceNO" property="sequenceNO"/>
	  			<result column="ID" property="ID"/>
	  			<result column="riqi" property="riqi"/>
	  			<result column="qiandao" property="qiandao"/>
	  			<result column="qiantui" property="qiantui"/>
	  			<result column="remark" property="remark"/>
	  		</association>	
	  		<association property="salary" javaType="Salary">
	  			<id column="SequenceNO" property="sequenceNO"/>
	  			<result column="ID" property="ID"/>
	  			<result column="base" property="base"/>
	  			<result column="reward" property="reward"/>
	  			<result column="sale" property="sale"/>
	  			<result column="tax" property="tax"/>
	  			<result column="other" property="other"/>
	  			<result column="actual" property="actual"/>
	  		</association>	
   		</resultMap>
   		
   		<resultMap type="TeacherBanji" id="findTeacherBanji">
   			<id column="ID" property="ID"/>
	  		<result column="teacher_id" property="teacherID"/>	
	  		<result column="banji_id" property="banjiID"/>	
   		</resultMap>
   		
   		<select id="findClassTeacher" resultMap="findTeacher">
   			select * from teacher
   		</select>
   		
   		<select id="findTeacherCount" resultType="int">
   			select count(*) from teacher
   		</select>
   		
   		<select id="findAllTeacher" resultMap="findTeacher">
   			SELECT *
			FROM teacher AS t LEFT JOIN category AS c 
			ON t.category_id = c.sequenceNO limit #{index},#{pageSize}
   		</select>
   		
   		<select id="findMajorTeacher" parameterType="String" resultMap="findTeacher">
   			SELECT *
			FROM teacher AS t INNER JOIN teacher_banji AS tb 
			ON t.sequenceNO = tb.teacher_id INNER JOIN banji AS b 
			ON b.sequenceNO = tb.banji_id WHERE b.banjiID = #{ID};
   		</select>
   		
   		<select id="showTeacher" parameterType="String" resultMap="findTeacher">
   			SELECT t.sequenceNO,t.ID,t.NAME,t.age,t.gender,t.address,t.birthday,t.picture,c.ID as courseID,c.name as coursename,cy.ID,cy.title 
			FROM teacher AS t LEFT JOIN course AS c
			ON t.course_id = c.sequenceNO LEFT JOIN category AS cy
			ON t.category_id = cy.sequenceNO WHERE t.ID = #{ID}
   		</select>
   		
   		<select id="findNotMajorTeacher" resultMap="findTeacher">
   			select * from teacher where category_id = 5
   		</select>
   		
   		<insert id="addMajorTeacher" parameterType="Map">
   			insert into teacher_banji (ID,teacher_id,banji_id) values(#{ID},#{teacherSequenceNO},#{banjiSequenceNO})
   		</insert>
   		
   		<update id="updateTeacherCategory" parameterType="int">
   			update teacher set category_id = 6 where sequenceNO = #{sequenceNO}
   		</update>
   		
   		<update id="updateOldTeacherCategory" parameterType="String">
   			update teacher set category_id = 5 where ID = #{ID}
   		</update>
   		
   		<select id="findOldMajorTeacher" parameterType="int" resultMap="findTeacherBanji">
   			select * from teacher_banji where banji_id = #{banjiID}
   		</select>
   		
   		<select id="findOldTeacher" parameterType="int" resultMap="findTeacher">
   			select * from teacher where sequenceNO = #{teacherID}
   		</select>
   		
   		<update id="updateTeacherBanji">
   			update teacher_banji set teacher_id = #{teacherID} where ID = #{ID}
   		</update>
   		
   		<delete id="deleteTeacher" parameterType="String">
   			delete from teacher where ID = #{ID}
   		</delete>
   		
   		<insert id="addTeacher" parameterType="Teacher">
   			insert into teacher(ID,name,age,gender,address,birthday,picture,category_id,course_id)
   			values(#{ID},#{name},#{age},#{gender},#{address},#{birthday},#{picture},#{category.sequenceNO},#{course.sequenceNO});
   		</insert>
   		
   		<update id="updateTeacher" parameterType="Teacher">
  	 		update teacher 
  	 		<set>
  	 			<if test="name != null and name != '' ">
  	 				name = #{name},
  	 			</if>
  	 			<if test="age != 0 and age != '' ">
  	 				age = #{age},
  	 			</if>
  	 			<if test="gender != 0">
  	 				gender = #{gender},
  	 			</if>
  	 			<if test="address != null and address != '' ">
  	 				address = #{address},
  	 			</if>
  	 			<if test="birthday != null and birthday != '' ">
  	 				birthday = #{birthday},
  	 			</if>
  	 			<if test="picture != null and picture != '' ">
  	 				picture = #{picture},
  	 			</if>
  	 			<if test="course != null">
  	 				course_id = #{course.sequenceNO},
  	 			</if>
  	 		</set>
  	 		WHERE ID = #{ID}
  	 	</update>
  	 	
  	 	<select id="findTeacherCountByCondition" resultType="int">
  	 		SELECT count(*)
			FROM teacher AS t LEFT JOIN category AS c 
			ON t.category_id = c.sequenceNO
  	 		<where>
  	 			<if test="name != null || name != '' ">
					and name like '%${name}%'
				</if>
				<if test="gender != 0">
					and gender = #{gender}
				</if>
  	 		</where>
  	 	</select>
  	 	
  	 	<select id="findStudentByCondition" parameterType="Map" resultType="Teacher" >
  	 		SELECT *
			FROM teacher AS t LEFT JOIN category AS c 
			ON t.category_id = c.sequenceNO
			<where>
				<if test="name != null || name != '' ">
					and name like '%${name}%'
				</if>
				<if test="gender != 0">
					and gender = #{gender}
				</if>
			</where> 
			limit #{index},#{pageSize}
  	 	</select>
  	 	
  	 	<select id="checkTeacher" resultMap="findTeacher">
  	 		SELECT t.sequenceNO,t.ID,t.NAME,t.password,c.ID AS categoryID 
			FROM teacher AS t INNER JOIN category AS c 
			ON t.category_id = c.ID 
			where name = #{name} and password = #{password}
  	 	</select>
   </mapper>